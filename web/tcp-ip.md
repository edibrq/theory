# Протокол TCP/IP или как работает интернет

[Ссылка на источник](https://www.youtube.com/watch?v=2I1HnSN1H9o&t=27s&ab_channel=ListenIT)

Все почти как на старой почте 

Опишем алгоритм действий, происходящих на почте:

- Мы пишем на листке письмо;
- Кладем письмо в конверт, заклеиваем
- На обратной стороне конверта пишем адреса отправителя и получателя;
- Несем конверт в ближайшее отделение почты;
- Письмо проходит через цепочку почтовых отделений до ближайшего к получателю;
- Почтальон относит письмо получателю или кладет его в почтовый ящик с номером квартиры;
- Когда поулчатель захочет ответить, то он в ответном письме поменяет адреса местами и писмо отправится по той же цепочке, но в обратном направлении

Вот так будет выглядеть результат:

> **Адрес отправителя:** \
> От кого: Иванов Иван Иванович \
> Откуда: Камушенск, Тутуево, ул В.Жмышенко 54

> **Адрес получателя:** \
> Кому: Петров Петр \
> Куда: Москва, ул Академика Волгина 4

## Взаимодействие в сети

Взаимодействие компьютеров в сети происходит примерно по такой же цепочке

Каждый компьютер (узел, хост) в сети Интернет имеет уникальный адрес - IP-адрес (Internet Protocol Address), например 195.34.54.1

Адрес состоит из 4 цифр от 0 до 255, которые разделены точкой

Но знать только IP-адрес еще не достаточно, чтобы отправить информацию, так как информацией обмениваются не компьютеры сами по себе, а приложения, которые запущены на них, поэтому нужно также знать номер приложения - его порт (например, почтовый сервис имеет порт 25 или слушает 25 порт, веб сервис 	- 80, FTP - 25 и т. д.).

Аналогия тут следующая: для доставки письма не достаточно знать просто номер дома, также нужно знать номер квартиры, этаж и другую информацию и каждое запущенное приложение имеет такой же номер - номер порта

Еще раз
> Адрес дома - IP-адрес компьютера \
> Номер квартиры - порт, который слушает приложение 

В компьютерных сетях, работающих по протоколам TCP/IP, аналогом бумажного письма является **пакет**, который содержит передаваемые данные и адреса отправителя и получателя

> **Адрес отправителя (Source address):** \
> IP: 123.111.23.1 \
> Port: 2054

> **Адрес получателя (Destination address):** \
> IP: 192.168.0.1 \
> Port: 54

> **Данные пакета** \
> ...

Внутри пакета содержится служебная информация, но на данный момент это не важно

> Комбинация IP-aдреса и порта называется **сокетом**

В данном примере с сокетом 123.111.23.1:2054 отправляем пакет на сокет 192.168.0.1:54. То есть информация пойдет на компьютер с IP-адресом 192.168.0.1 на порт 54, которому соответствует сервер распознавания имен (DNS сервер), который примет этот пакет.

Зная адрес отправителя этот сервер может после обработки запроса сформировать ответный пакет, который пойдет в обратном направлении на адрес 123.111.23.1 и сокет 2054, который будет для DNS сервера отправителя будет являться получателем

> Как правило взаимодействие осуществляется по схеме "клиент-сервер"
> "Клиент" запрашивает информацию, а сервер принимает запрос, обрабатывает его и посылает результат.

Большая часть програм на ПК являются клиентами: почтовые клиенты, браузеры и пр.

Номера портов на клиенте не фиксированные, как у сервера, а назначаются ОС динамически.

Фискисрованные серверные порты, как правило имеют номера до 1024 (но есть исключения), а клиентские начинаются после 1024.

С цифровыми IP-адресами работать довольно трудно, куда проще работать с буквенным представлением, не так-ли?

> Любой цифровой IP-адрес можно связять с буквенно-цифровым именем. Например вместо 23.54.123.1 можно использовать имя www.example.com. \
> Преобразованием доменного имени в цифровой IP-адрес занимается сервис доменных имен - DNS (Domain Name Server).

## Описание взаимодействие компьютера и сервера

Рассмотрим поподробнее, как это работает

Провайдер на бумажке (для ручной настройки соединения) или неявно (через автоматическую настройку соединения) предоставляет вам IP-адрес сервера имен DNS. На копмьютере с этим IP-aдресом работает приложение (сервер имен), которое знает все доменные имена в интернете и соответствующие им IP-адреса. 

DNS сервер слушает 53 порт, принимает на него запрос и выдает ответы, например

> Запрос от нашего компьютера: "Какой IP-адрес соответствует имени www.example.com?" \
>  Ответ сервера: "23.54.123.1"

Теперь рассмотрим, что происходит, когда в браузере мы вводим доменное имя (URL) сайта www.example.com и получаем в ответ от WEB-сервера эту страницу.

> IP-адрес нашего компьютера: 123.111.23.1 \
> Браузер: Google Chrome \
> DNS сервер: 195.34.32.216 \
> Страница, которую хотим открыть: www.example.com

Жмякаем Enter, далее ОС отправляет пакет с запросом на DNS сервер на сокет 195.34.32.216:53 и DNS сервер, обработав наш запрос, возвращает IP-адрес, который соответствует введённому имени.

Происходит примерно следующий диалог: \
-Браузер: Какой адрес соответствует доменному имени www.example.com? \
-Сервер: 23.54.123.1.

Далее наш компьютер устанавливает соединение с портом 80 компьютера 23.54.123.1 и посылает пакет с запросом на получение страницы www.example.comю.

Приняв от нас запрос, веб-сервер обрабатывает его и в нескольких пакетах посылает нам страницу на языке HTML - языке разметки, который понимает браузер.

Браузер, получив страницу, отображает её, и мы видим сайт.

Можно также проверить установленных соединений между сокетами нашего компьютера и сокетами удаленных узлов. Для этого можно использовать следующую команду: 

```bash
netstat -an
```

## Важные порты

Рассмотрим некоторые важные порты:

135-139 - эти порты используются ОС для доступа к общим ресурсам компьютера (папкам, принтерам, ...). Не стоит открывать данные порты в интернет.

21 - порт FTP сервера (File Transfer Protocol).

25 - порт почтового SMTP сервера. Через него почтовый клиент отправляет письма.

110 - порт POP3 сервера. Через него почтовый клиент забирает письма из почтового ящика. 

80 - порт WEB-сервера.

3120, 8080 - прокси-серверы.

## Важные IP-адреса

127.0.0.1 - это localhost, адрес локальной системы, т. е. локальный адрес компьютера

0.0.0.0 - так обозначаются все IP-адреса.

192.168.ххх.ххх - адреса, которые можно использовать в локальных сетях, в глобальной сети они не используются. Они уникальны только в рамках локальной сети и могут быть использованы для собственной сети.

## Маска подсети и шлюз по умолчанию (роутер, маршрутизатор)

Компьютеры объединяются в локальные сети. В локальной сети компьютеры напрямую видят друг друга. Локальные сети соединяются друг с другом через ***шлюзы*** (роутеры, маршрутизаторы).

***Маска подсети*** предназначена для определения - принадлежит ли компьютер-получатель к этой же локальной сети или нет. Если принадлежит, то пакет передается ему напрямую, в противном случае пакет отправляется на шлюз по умолчанию, который далее, по известным маршрутам, передает пакет в другую сеть.

## Заключение

Повторим все вышесказанное.

***TCP/IP*** - набор сетевых протоколов. Передаваемый пакет проходит несколько уровней (как на почте: сначала пишем письмо, затем помещаем в конверт с адресом, а потом на почте ставится штамп и т. д. ...)

***IP протокол*** - это протокол ***сетевого уровня*** - доставка IP-пакетов от отправителя к получателю. Кроме собственных данных, пакеты этого уровня имеют IP-адрес отправителя и получателя. Номера портов на сетевом уровне не используются, а также на этом уровне неизвестно, был-ли пакет доставлен.

***TCP*** и ***UDP*** - протоволы ***транспортного уровня***. Он находится над сетевым. На нём к пакету добавляются порты отправителя и получателя.

***TCP*** - протокол с установлением соединения с гарантированной доставкой пакетов. Если пакет не дошел, то он посылается повторно.

***UDP*** - протокол без установления соединения и с негарантированной доставкой пакетов.

Над транспортным уровнем находится прикладной уровень, на котором работают такие протоколы, как HTTP, FTP и пр.