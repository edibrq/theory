# Базовый Postgres

[Ссылка на полезную книжку](http://www.r-5.org/files/books/computers/languages/sql/mysql/Alan_Beaulieu-Learning_SQL-RU.pdf)

База данных отвечает за следующие вещи:

- Хранение данных;
- Умправление данными;
- Извлечение данных.

Для манипуляции над данными существует язык SQL (**S**tructured **Q**uery **L**anguage)

В языке SQL традиционно выделяются группа операторов определения данных (Data Definition Language — DDL), группа операторов
манипулирования данными (Data Manipulation Language — DML) и группа операторов, управляющих привилегиями доступа к объектам базы данных (Data Control
Language — DCL).
К операторам языка определения данных (DDL) относятся команды для создания, изменения и удаления таблиц, представлений и других объектов базы данных. 
К операторам языка манипулирования данными (DML) относятся команды для выборки строк из таблиц, вставки строк в таблицы, обновления и удаления строк.

Самый типичный пример запроса на данном языке выглядит следующим образом:

```sql
SELECT * FROM table_name
```

Синтаксис данного языка интуитивно понятен, на примере выше выбирается вся информация из какой-то таблицы, с помощью оператора *

Если ты на маке или линуксе, то для удобства стоит изначально добавить путь до бинарных файлов PSQL в переменные окружения для дальнейшего удобства использования БД из консоли.

Чтобы сделать это в локальном конфиге (.zshrc или .bashrc) нужно прописать следующую команду:

```bash
export PATH=$PATH:/Applications/Postgres.app/Contents/Versions/14/bin
```

> Стоит заметить, что путь к папке может быть немного иным, при установке разных версий PSQL, но примерный путь должен остаться таким же.

## Основные команды внутри терминала PostgreSQL 

1. \l - отображает список доступных баз данных для подключения
2. \c - подключиться к базе данных под дефолтным пользователем
3. \d - отображает список доступных таблиц в базе данных
4. \d <tablename> - отобразить информацию о конкретной таблице
5. \? - функция ПАМАГИТЕ или просто хороший гайд по всем командам

## Основные операции над таблицей (DDL-команды)

1. Создание таблицы:
```sql
CREATE TABLE table_name (
	Column name + data type + constraints if any
);
```
2. Удаление таблицы: 
```sql
DROP TABLE [IF EXISTS] table_name [CASCADE];
```
3. Вставка в таблицу:
```sql
INSERT INTO table_name (
	column1,
	column2,
	column3,
	...
) VALUES ('VALUE1', 'VALUE2', 'VALUE3', ...)
```
4. Изменение данных и добавление и удаление ограничений:
```sql
ALTER TABLE table_name {
	ADD column_name comumn_type [column_attr] | 
  	DROP COLUMN column_name |
  	ALTER COLUMN column_name comumn_type [NULL|NOT NULL] |
  	ADD [CONSTRAINT] constraint_definition |
  	DROP [CONSTRAINT] constraint_definition
	USING ( CASE WHEN column = 'something1' THEN 1
			WHEN column = 'something2' THEN 2
			ELSE 3 END
		  );
	RENAME [COLUMN | CONSTRAINT | TABLE] column_name TO new_column_name;
}
```
5. Обновление данных в таблице:
```sql
UPDATE table_name
	SET attr_name1 = attr_value1,
		attr_name2 = attr_value2,
		...
	WHERE <condition>
```
6. Удаление данных из таблицы:
```sql
DELETE FROM table_name WHERE <condition>;
```

Также на поля можно накладывать ограничения:

- ``` NOT NULL``` - поле не может существовать без значения
- ``` PRIMARY KEY ``` - поле является первичным ключом, содержит в себе ```NOT NULL```
- ```FORIGN KEY``` - поле является внешним ключем, необходимым для связи таблиц

## Команды для манипуляции данными (DML команды)

1. ORDER BY команды SELECT - позволяет сгруппировать данные

```sql
SELECT column1, column2, ...
FROM table_name
ORDER BY column1
```

2. Далеко не всегда требуется выбирать ВСЕ строки из таблицы. Множество выбираемых
строк можно ограничить с помощью предложения WHERE команды SELECT. 

```sql
SELECT column1, column2, ...
FROM table_name
WHERE column1 >= 10 AND column1 <= 20
```

## Типы данных PostgreSQL

### Числовые типы

Целочисленные:

- smallint
- integer
- bigint

Числа с фиксированноу точностью:

- numeric(n, m)
- decimal(n, m)

Символьные типы:

- varchar(n) (varying character)
- char(n) (character) - забивает остаток места пробелами
- text

Типы для хранения даты и времени:

- date
- timestamptz (timestamp with time zone)
- timestamp
- current_date, current_time, current_timestamp - функции, применяемые для получения значений по умолчанию при вставке строк в таблицы.

### Логический тип

Логический (boolean) тип может иметь три состояния: «true» и «false», а также неопределенное состояние, которое можно представить значением NULL. Таким образом,
тип boolean реализует трехзначную логику.
В качестве состояния «true» могут служить следующие значения: TRUE, 't', 'true', 'y',
'yes', 'on', '1'.
В качестве состояния «false» могут служить следующие значения: FALSE, 'f', 'false', 'n',
'no', 'off', '0'.

### JSON-файлы

- json
- jsonb - разбор производится однократно, при записи значения в таблицу, рекоммендуем.

## Представления 

При работе с базами данных зачастую приходится многократно выполнять одни и те
же запросы, которые могут быть весьма сложными и требовать обращения к нескольким таблицам. Чтобы избежать необходимости многократного формирования таких
запросов, можно использовать так называемые представления (views). Если речь идет
о выборке данных, то представления практически неотличимы от таблиц с точки зрения обращения к ним в командах SELECT.
Упрощенный синтаксис команды CREATE VIEW, предназначенной для создания
представлений, таков:

```sql
CREATE VIEW [OR REPLACE] name [ ( column_name [, ...] ) ]
AS query;
```

## Схемы базы данных

Схема — это логический фрагмент базы данных, в котором могут содержаться различные объекты: таблицы, представления, индексы и др. В базе данных обязательно
есть хотя бы одна схема. При создании базы данных в ней автоматически создается
схема с именем public.

В каждой базе данных может содержаться более одной схемы. Их имена должны быть
уникальными в пределах конкретной базы данных. Имена объектов базы данных
(таблиц, представлений, последовательностей и др.) должны быть уникальными в
пределах конкретной схемы, но в разных схемах имена объектов могут повторяться. Таким образом, можно сказать, что схема образует так называемое пространство
имен.

Посмотреть список схем в базе данных можно так:
```bash
\dn
```

